<!DOCTYPE html>
<!--
 | Generated by Apache Maven Doxia Site Renderer 1.7.4 at 2017-10-12 
 | Rendered using Apache Maven Fluido Skin 1.6
-->
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="Date-Revision-yyyymmdd" content="20171012" />
    <meta http-equiv="Content-Language" content="en" />
    <title>camunda-bpm-mockito &#x2013; camunda-bpm-mockito</title>
    <link rel="stylesheet" href="./css/apache-maven-fluido-1.6.min.css" />
    <link rel="stylesheet" href="./css/site.css" />
    <link rel="stylesheet" href="./css/print.css" media="print" />
      <script type="text/javascript" src="./js/apache-maven-fluido-1.6.min.js"></script>
      </head>
    <body class="topBarEnabled">
                      <a href="https://github.com/camunda/camunda-bpm-mockito">
      <img style="position: absolute; top: 0; right: 0; border: 0; z-index: 10000;"
        src="https://s3.amazonaws.com/github/ribbons/forkme_right_red_aa0000.png"
        alt="Fork me on GitHub">
    </a>
      <div id="topbar" class="navbar navbar-fixed-top navbar-inverse">
      <div class="navbar-inner">
            <div class="container"><div class="nav-collapse">
            <ul class="nav">
        <li class="dropdown">
        <a href="#" class="dropdown-toggle" data-toggle="dropdown">camunda-bpm-mockito <b class="caret"></b></a>
        <ul class="dropdown-menu">
            <li><a href="index.html" title="About">About</a></li>
            <li><a href="release-notes/index.html" title="Release Notes">Release Notes</a></li>
        </ul>
      </li>
        <li class="dropdown">
        <a href="#" class="dropdown-toggle" data-toggle="dropdown">Project Documentation <b class="caret"></b></a>
        <ul class="dropdown-menu">
            <li class="dropdown-submenu">
<a href="project-info.html" title="Project Information">Project Information</a>
              <ul class="dropdown-menu">
                  <li><a href="dependencies.html" title="Dependencies">Dependencies</a></li>
                  <li><a href="dependency-info.html" title="Dependency Information">Dependency Information</a></li>
                  <li><a href="dependency-management.html" title="Dependency Management">Dependency Management</a></li>
                  <li><a href="distribution-management.html" title="Distribution Management">Distribution Management</a></li>
                  <li><a href="index.html" title="About">About</a></li>
                  <li><a href="issue-tracking.html" title="Issue Management">Issue Management</a></li>
                  <li><a href="license.html" title="Licenses">Licenses</a></li>
                  <li><a href="plugin-management.html" title="Plugin Management">Plugin Management</a></li>
                  <li><a href="plugins.html" title="Plugins">Plugins</a></li>
                  <li><a href="team-list.html" title="Team">Team</a></li>
                  <li><a href="source-repository.html" title="Source Code Management">Source Code Management</a></li>
                  <li><a href="project-summary.html" title="Summary">Summary</a></li>
              </ul>
            </li>
        </ul>
      </li>
              </ul>
                    <ul class="nav pull-right">
              <li class="dropdown">
                <a href="#" class="dropdown-toggle" data-toggle="dropdown">External Links <b class="caret"></b></a>
                <ul class="dropdown-menu">
    <li><a href="https://www.openhub.net/p/camunda-bpm-mockito" title="openhub">openhub</a></li>
                </ul>
              </li>
            </ul>
            </div>
        </div>
      </div>
    </div>
    <div class="container">
      <div id="banner">
        <div class="pull-left"><div id="bannerLeft"><h2>camunda-bpm-mockito</h2>
</div>
</div>
        <div class="pull-right"></div>
        <div class="clear"><hr/></div>
      </div>

      <div id="breadcrumbs">
        <ul class="breadcrumb">
        <li id="publishDate">Last Published: 2017-10-12<span class="divider">|</span>
</li>
          <li id="projectVersion">Version: 3.2.0-SNAPSHOT</li>
        </ul>
      </div>
        <div id="bodyColumn" >
<h1>camunda-bpm-mockito</h1>
<p><a class="externalLink" href="https://www.openhub.net/p/camunda-bpm-mockito"><img src="https://www.openhub.net/p/camunda-bpm-mockito/widgets/project_thin_badge.gif" alt="Project Stats" /></a></p>
<p><a class="externalLink" href="https://maven-badges.herokuapp.com/maven-central/org.camunda.bpm.extension.mockito/camunda-bpm-mockito"><img src="https://maven-badges.herokuapp.com/maven-central/org.camunda.bpm.extension.mockito/camunda-bpm-mockito/badge.svg" alt="Maven Central" /></a></p>

<blockquote>
<p>:bangbang: With release 3.0.0 the groupId changed, it is now <tt>org.camunda.bpm.extension.mockito</tt> :bangbang:</p>
</blockquote>
<p><b>simplify process mocking and testing</b></p>
<p>camunda-bpm-mockito is a community extension for the Camunda BPM process engine that aims to simplify and automate mocking of process applications.</p>
<p><b>Features:</b></p>

<ul>
  
<li>Fluent mocking of query API - It is now very easy to mock a complex fluent query for the service API without any redundancy.</li>
  
<li>Fluent mocking of Listener and Delegate behavior - since delegate and listener methods are void, they can either modify process variables or raise an error. Instead of messing up with mockito&#x2019;s doAnswer() you can use these options with a fluent API.</li>
  
<li>Helpers for registering, retrieving and verifying mocks - convenience methods around Mocks.register().</li>
  
<li>Automatic mocking of all expressions and delegates in a process - without explicitly registering mocks, all instances are mocked by default, so no process will fail to run because a JUEL expression is using an unknown statement or identifier.</li>
</ul>
<div class="section">
<h2><a name="Get_started"></a>Get started</h2>
<p>Just include camunda-bpm-mockito in the test scope of your project:</p>

<div class="source">
<div class="source"><pre class="prettyprint linenums">&lt;dependency&gt;
  &lt;groupId&gt;org.camunda.bpm.extension.mockito&lt;/groupId&gt;
  &lt;artifactId&gt;camunda-bpm-mockito&lt;/artifactId&gt;
  &lt;scope&gt;test&lt;/scope&gt;
  &lt;version&gt;3.1.0&lt;/version&gt;
&lt;/dependency&gt;
</pre></div></div></div>
<div class="section">
<h2><a name="Mocking_of_queries"></a>Mocking of queries</h2>
<p>Sometimes you want to test a Bean that uses the query API. Since the API is fluent, you would have to mock every single parameter call and let your service return the mocked query.</p>
<p>With the QueryMocks extension, you can do all this in just one line of code, see <a href="src/test/java/org/camunda/bpm/extension/mockito/QueryMocksExample.java">QueryMocksExample.java</a>.</p>

<div class="source">
<div class="source"><pre class="prettyprint linenums">  public class QueryMocksExample {
    private final TaskService taskService = mock(TaskService.class);
    private final Task task = mock(Task.class);
    
    @Test
    public void mock_taskQuery() {
        // bind query-mock to service-mock and set result to task.
        final TaskQuery taskQuery = QueryMocks.mockTaskQuery(taskService).singleResult(task);

        final Task result = taskService.createTaskQuery().active().activityInstanceIdIn(&quot;foo&quot;).excludeSubtasks().singleResult();

        assertThat(result).isEqualTo(task);

        verify(taskQuery).active();
        verify(taskQuery).activityInstanceIdIn(&quot;foo&quot;);
        verify(taskQuery).excludeSubtasks();
    }
}
</pre></div></div></div>
<div class="section">
<h2><a name="Mock_Listener_and_Delegate_behavior"></a>Mock Listener and Delegate behavior</h2>
<p>Mocking void methods using mockito is not very convenient, since you need to use the doAnswer(Answer&lt;T&gt;).when() construct, implement your own answer and pick up the parameter from the invocation context. JavaDelegate and ExecutionListener are providing their basic fuctionality using void methods.<br />In general, when working with the Delegate and Listener interfaces, there are basically two things they can do from the point of interaction between the process execution: modify process variables and raise errors. </p>
<p>We can use this to test bpmn-processes without relying on the delegate implementation. </p>

<div class="source">
<div class="source"><pre class="prettyprint linenums">public class FluentJavaDelegateMockTest {

  private static final String BEAN_NAME = &quot;foo&quot;;
  private static final String MESSAGE = &quot;message&quot;;

  @Rule
  public final ExpectedException thrown = ExpectedException.none();

  @Test
  public void shouldThrowBpmnError() throws Exception {

    // expect exception
    thrown.expect(BpmnError.class);
    thrown.expectMessage(MESSAGE);

    DelegateExpressions.registerJavaDelegateMock(BEAN_NAME).onExecutionThrowBpmnError(&quot;code&quot;, MESSAGE);

    final JavaDelegate registeredDelegate = DelegateExpressions.getJavaDelegateMock(BEAN_NAME);

    // test succeeds when exception is thrown
    registeredDelegate.execute(mock(DelegateExecution.class));
  }
}
</pre></div></div></div>
<div class="section">
<h2><a name="Easy_register_and_verify_mocks"></a>Easy register and verify mocks</h2>
<p>In addition two of the well-known &#x201c;Mocks.register()&#x201d; hook, you now have the possibility to register fluent mocks directly:</p>

<div class="source">
<div class="source"><pre class="prettyprint linenums"> registerJavaDelegateMock(&quot;name&quot;)
 registerMockInstance(YourDelegate.class)
</pre></div></div>
<p>In the latter case, &#x201c;YourDelegate&#x201d; has to be annotated with @Named, @Component or @Service, depending on the injection framework you are using.</p>
<p>To verify the Mock execution, you can use</p>

<div class="source">
<div class="source"><pre class="prettyprint linenums">verifyJavaDelegateMock(&quot;name&quot;).executed(times(2));
</pre></div></div></div>
<div class="section">
<h2><a name="Auto_mock_all_delegates_and_listeners"></a>Auto mock all delegates and listeners</h2>
<p>With the autoMock() feature, you can register all Delegates and Listeners at once, without explicitly adding &#x201c;register&#x201d;-statements to your testcase. If you do need to specify behaviour for the mocks, you can still get the mock via &#x201c;getRegisteredJavaDelegateMock&#x201d; (for delegates).</p>

<div class="source">
<div class="source"><pre class="prettyprint linenums">@Test
@Deployment(resources = &quot;MockProcess.bpmn&quot;)
  public void register_mocks_for_all_listeners_and_delegates() throws Exception {
    autoMock(&quot;MockProcess.bpmn&quot;);

    final ProcessInstance processInstance = processEngineRule.getRuntimeService().startProcessInstanceByKey(&quot;process_mock_dummy&quot;);

    assertThat(processEngineRule.getTaskService().createTaskQuery().processInstanceId(processInstance.getId()).singleResult()).isNotNull();

    verifyTaskListenerMock(&quot;verifyData&quot;).executed();
    verifyExecutionListenerMock(&quot;startProcess&quot;).executed();
    verifyJavaDelegateMock(&quot;loadData&quot;).executed();
    verifyExecutionListenerMock(&quot;beforeLoadData&quot;).executed();
  }
</pre></div></div></div>
<div class="section">
<h2><a name="DelegateTaskExecutionFake"></a>Delegate[Task|Execution]Fake</h2>
<p>Unit-testing listeners and JavaDelegates can be difficult, because the methods are void and only  white-box testing via verify is possible. But most of the times, you just want to  confirm that a certain variable was set (or a dueDate, a candidate, &#x2026;).</p>
<p>In these cases, use the Delegate fakes. The implement the interfaces DelegateTask and DelegateExecution, but are implemented as plain, fluent-styled Pojos.</p>
<p>So to test if your TaskListener</p>

<div class="source">
<div class="source"><pre class="prettyprint linenums">TaskListener taskListener = task -&gt; {
  if (EVENTNAME_CREATE.equals(task.getEventName()) &amp;&amp; &quot;the_task&quot;.equals(task.getTaskDefinitionKey())) {
    task.addCandidateGroup((String) task.getVariableLocal(&quot;nextGroup&quot;));
  }
};
</pre></div></div>
<p>actually adds a candidateGroup that is read from a taskLocal variable on create, you can write a Test like this one:</p>

<div class="source">
<div class="source"><pre class="prettyprint linenums">@Test
public void taskListenerSetsCandidateGroup() throws Exception {
  // given a delegateTask 
  DelegateTask delegateTask = delegateTaskFake()
    .withTaskDefinitionKey(&quot;the_task&quot;)
    .withEventName(EVENTNAME_CREATE)
    .withVariableLocal(&quot;nextGroup&quot;, &quot;foo&quot;);

  // when
  taskListener.notify(delegateTask);

  // then the candidate group was set
  assertThat(candidateGroupIds(delegateTask)).containsOnly(&quot;foo&quot;);

}
 
</pre></div></div></div>
<div class="section">
<h2><a name="Release_Notes"></a>Release Notes</h2>
<div class="section">
<h3><a name="a3.1"></a>3.1</h3>

<ul>
  
<li>delegateTask now supports IdentityLinks (candidateUsers and -groups)</li>
  
<li>support of typed variables</li>
</ul></div>
<div class="section">
<h3><a name="a3.0"></a>3.0</h3>

<ul>
  
<li>switch to camunda 7.6.0</li>
  
<li>switch to java8</li>
  
<li>support all new query types</li>
  
<li><tt>CamundaMockito.*</tt> now is the single import you need to use all features from <tt>DelegateExpressions</tt>, <tt>Expressions</tt> and <tt>QueryMocks</tt>.</li>
  
<li>DelegateExecution and DelegateTask now can be used via &#x201c;fake&#x201d; implementations which makes preparation and assertions much easier when testing dlegates and listeners. Use of typed variables is not supported for now, though.</li>
</ul></div>
<div class="section">
<h3><a name="a2.2"></a>2.2</h3>

<ul>
  
<li>add support for asc() and desc() query methods (see #26)</li>
</ul></div>
<div class="section">
<h3><a name="a2.0"></a>2.0</h3>

<ul>
  
<li>switch to camunda 7.2</li>
  
<li>remove org.camunda.bpm.extension.util.ProcessVariableMaps -&gt; use Variables instead</li>
  
<li>remove dependencies to cdi (you will have to add them again to use the extension with cdi/ejb)</li>
  
<li>add support for spring expressions</li>
</ul></div></div>
<div class="section">
<h2><a name="Limitations"></a>Limitations</h2>

<ul>
  
<li>Though it is possible to use arbitrary beans as expressions (myBean.doSomething()), we solely focus on Listeners (notify()) and Delegates (execute()) here, since this is the only way to apply automatic behavior. If you need to mock custom beans, you still can use some of the tools to register the mock, but can not use the fluent mocking or auto mocking feature. Due to the nature of automatic mocking, this is immanent and will not change.</li>
  
<li>Currently, only expression-delegates (${myDelegate}) are supported (as you do use with CDI/Spring)) but no FQN class names. This might and probably will change with future versions, it just has to be implemented &#x2026;</li>
  
<li>while automocking, expressions are only parsed for listeners and delegates, not for process variables.</li>
</ul></div>
<div class="section">
<h2><a name="Resources"></a>Resources</h2>

<ul>
  
<li><a class="externalLink" href="https://github.com/camunda/camunda-bpm-mockito/issues">Issue Tracker</a></li>
  
<li><a class="externalLink" href="https://github.com/camunda/camunda-bpm-mockito/blob/master/CONTRIBUTING.md">Contributing</a></li>
  
<li><a class="externalLink" href="https://www.openhub.net/p/camunda-bpm-mockito">openhub</a></li>
</ul></div>
<div class="section">
<h2><a name="Maintainer"></a>Maintainer</h2>

<ul>
  
<li><a class="externalLink" href="https://github.com/jangalinski">Jan Galinski</a></li>
  
<li><a class="externalLink" href="https://github.com/zambrovski">Simon Zambrovski</a></li>
  
<li><a class="externalLink" href="https://github.com/hawky-4s-">Christian Lipphardt</a></li>
</ul></div>
<div class="section">
<h2><a name="License"></a>License</h2>

<ul>
  
<li><a href="./LICENSE">Apache License, Version 2.0</a></li>
</ul></div>
        </div>
    </div>
    <hr/>
    <footer>
      <div class="container">
        <div class="row">
            <p>Copyright &copy;2017
<a href="http://www.camunda.com">camunda services GmbH</a>.
All rights reserved.</p>
        </div>
        <p id="poweredBy" class="pull-right">  <a href="http://maven.apache.org/" title="Built by Maven" class="poweredBy"><img class="builtBy" alt="Built by Maven" src="./images/logos/maven-feather.png" /></a>
  </p>
        </div>
    </footer>
    </body>
</html>
